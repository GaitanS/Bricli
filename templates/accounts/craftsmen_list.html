{% extends 'base.html' %}

{% block title %}Meșteri verificați - Bricli{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-12">


            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="mb-1">Meșteri verificați</h1>
                    <p class="text-muted">Găsește specialiști de încredere pentru proiectele tale</p>
                </div>
                {% if not user.is_authenticated %}
                <div>
                    <a href="{% url 'accounts:craftsman_register' %}" class="btn btn-primary">
                        <i class="fas fa-user-plus me-2"></i>Devino meșter
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="GET" class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Meserie</label>
                            <select name="trade" class="form-select">
                                <option value="">Toate meseriile</option>
                                <option value="Electrician" {% if request.GET.trade == 'Electrician' %}selected{% endif %}>Electrician</option>
                                <option value="Instalator" {% if request.GET.trade == 'Instalator' %}selected{% endif %}>Instalator</option>
                                <option value="Tâmplar" {% if request.GET.trade == 'Tâmplar' %}selected{% endif %}>Tâmplar</option>
                                <option value="Zugrav" {% if request.GET.trade == 'Zugrav' %}selected{% endif %}>Zugrav</option>
                                <option value="Zidar" {% if request.GET.trade == 'Zidar' %}selected{% endif %}>Zidar</option>
                                <option value="Acoperișuri" {% if request.GET.trade == 'Acoperișuri' %}selected{% endif %}>Acoperișuri</option>
                                <option value="Grădinărit" {% if request.GET.trade == 'Grădinărit' %}selected{% endif %}>Grădinărit</option>
                                <option value="Curățenie" {% if request.GET.trade == 'Curățenie' %}selected{% endif %}>Curățenie</option>
                                <option value="Transport" {% if request.GET.trade == 'Transport' %}selected{% endif %}>Transport</option>
                                <option value="IT" {% if request.GET.trade == 'IT' %}selected{% endif %}>IT</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Județ</label>
                            <select name="county" class="form-select">
                                <option value="">Toate județele</option>
                                {% for county in counties %}
                                    <option value="{{ county.id }}" {% if request.GET.county == county.id|stringformat:"s" %}selected{% endif %}>
                                        {{ county.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Rating minim</label>
                            <select name="rating" class="form-select">
                                <option value="">Orice rating</option>
                                <option value="5" {% if request.GET.rating == '5' %}selected{% endif %}>5 stele</option>
                                <option value="4" {% if request.GET.rating == '4' %}selected{% endif %}>4+ stele</option>
                                <option value="3" {% if request.GET.rating == '3' %}selected{% endif %}>3+ stele</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary me-2">
                                <i class="fas fa-filter me-1"></i>Filtrează
                            </button>
                            <a href="{% url 'accounts:craftsmen_list' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>Resetează
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Statistics -->
            {% if total_craftsmen > 0 %}
            <div class="row text-center mb-4">
                <div class="col-md-4">
                    <div class="card text-white" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                        <div class="card-body py-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-users fa-2x me-3"></i>
                                <div>
                                    <h2 class="mb-0 fw-bold">{{ total_craftsmen }}</h2>
                                    <small class="opacity-75">Meșteri activi</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-white" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        <div class="card-body py-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-shield-check fa-2x me-3"></i>
                                <div>
                                    <h2 class="mb-0 fw-bold">{{ verified_craftsmen }}</h2>
                                    <small class="opacity-75">Meșteri verificați</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-white" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <div class="card-body py-4">
                            <div class="d-flex align-items-center justify-content-center">
                                <i class="fas fa-tools fa-2x me-3"></i>
                                <div>
                                    <h2 class="mb-0 fw-bold">{{ total_services }}</h2>
                                    <small class="opacity-75">Servicii disponibile</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-center py-5">
                <div class="mb-4">
                    <i class="fas fa-hard-hat text-muted" style="font-size: 4rem;"></i>
                </div>
                <h3 class="text-muted mb-3">Încă nu avem meșteri înregistrați</h3>
                <p class="text-muted mb-4">Fii primul meșter care se alătură comunității Bricli!</p>
                <a href="{% url 'accounts:simple_craftsman_register' %}" class="btn btn-lg text-white" style="background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);">
                    <i class="fas fa-user-plus me-2"></i>Înregistrează-te ca meșter
                </a>
            </div>
            {% endif %}

            <!-- Craftsmen List -->
            {% if craftsmen %}
                <div class="row">
                    {% for craftsman in craftsmen %}
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-3 text-center">
                                        {% if craftsman.user.profile_picture %}
                                            <img src="{{ craftsman.user.profile_picture.url }}" 
                                                 class="rounded-circle" width="80" height="80" alt="Profil">
                                        {% else %}
                                            <div class="bg-secondary text-white rounded-circle d-inline-flex align-items-center justify-content-center"
                                                 style="width: 80px; height: 80px;">
                                                <i class="fas fa-user fs-3"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-9">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h5 class="card-title mb-0">
                                                {{ craftsman.display_name|default:"Meșter profesionist" }}
                                            </h5>
                                            {% if craftsman.user.is_verified %}
                                            <span class="badge bg-success">
                                                <i class="fas fa-check-circle me-1"></i>Verificat
                                            </span>
                                            {% endif %}
                                        </div>
                                        
                                        <p class="text-muted mb-1">
                                            <i class="fas fa-tools me-1"></i>{{ craftsman.trade }}
                                        </p>
                                        <p class="text-muted mb-2">
                                            <i class="fas fa-map-marker-alt me-1"></i>{{ craftsman.county.name }}
                                        </p>

                                        <div class="d-flex align-items-center mb-2">
                                            {% for i in "12345" %}
                                                {% if forloop.counter <= craftsman.average_rating|floatformat:0|add:0 %}
                                                    <i class="fas fa-star text-warning"></i>
                                                {% else %}
                                                    <i class="far fa-star text-muted"></i>
                                                {% endif %}
                                            {% endfor %}
                                            <span class="ms-2 text-muted">({{ craftsman.reviews_count }} recenzii)</span>
                                        </div>

                                        {% if craftsman.description %}
                                        <p class="card-text small">{{ craftsman.description|truncatewords:15 }}</p>
                                        {% endif %}

                                        <div class="d-flex gap-2 mt-3">
                                            <a href="{% url 'accounts:craftsman_detail' craftsman.pk %}" 
                                               class="btn btn-outline-primary btn-sm flex-fill">
                                                Vezi profil
                                            </a>
                                            <a href="{% url 'services:create_order' %}?craftsman={{ craftsman.pk }}" 
                                               class="btn btn-primary btn-sm flex-fill">
                                                Contactează
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if is_paginated %}
                <nav aria-label="Paginare meșteri">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page=1{% if request.GET.trade %}&trade={{ request.GET.trade }}{% endif %}{% if request.GET.county %}&county={{ request.GET.county }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}">Prima</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.trade %}&trade={{ request.GET.trade }}{% endif %}{% if request.GET.county %}&county={{ request.GET.county }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}">Anterioară</a>
                            </li>
                        {% endif %}

                        <li class="page-item active">
                            <span class="page-link">{{ page_obj.number }} din {{ page_obj.paginator.num_pages }}</span>
                        </li>

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.trade %}&trade={{ request.GET.trade }}{% endif %}{% if request.GET.county %}&county={{ request.GET.county }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}">Următoarea</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.trade %}&trade={{ request.GET.trade }}{% endif %}{% if request.GET.county %}&county={{ request.GET.county }}{% endif %}{% if request.GET.rating %}&rating={{ request.GET.rating }}{% endif %}">Ultima</a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-users text-muted" style="font-size: 4rem;"></i>
                    <h3 class="mt-3">Nu am găsit meșteri</h3>
                    <p class="text-muted">Nu există meșteri care să corespundă criteriilor tale de căutare.</p>
                    <div class="mt-4">
                        {% if user.user_type != 'craftsman' %}
                            <a href="{% url 'services:create_order' %}" class="btn btn-primary me-3">
                                <i class="fas fa-plus me-2"></i>Postează o comandă
                            </a>
                        {% endif %}
                        <a href="{% url 'accounts:craftsmen_list' %}" class="btn btn-outline-primary">
                            <i class="fas fa-list me-2"></i>Vezi toți meșterii
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
