{% extends 'base.html' %}
{% load static %}
{% load lazy_loading %}
{% load service_icons %}
{% load testimonials %}

{% block title %}Bricli - Găsește meșterul potrivit pentru tine{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section text-white py-5">
    <div class="container">
        <div class="row align-items-center min-vh-75">
            <div class="col-lg-6 hero-content">
                <div class="fade-in">
                    <h1 class="display-4 fw-bold mb-4 text-shadow">
                        Găsește meșterul potrivit pentru tine
                    </h1>
                    <p class="lead mb-4 text-shadow">
                        Conectăm clienții cu meșteri verificați din România.
                        Postează gratuit cererea ta și primește oferte de la specialiști din zona ta.
                    </p>

                    <!-- Trust Indicators -->
                    <div class="d-flex gap-3 mb-4 flex-wrap">
                        <div class="trust-indicator">
                            <i class="fas fa-shield-alt"></i>
                            <span>Meșteri verificați</span>
                        </div>
                        <div class="trust-indicator">
                            <i class="fas fa-clock"></i>
                            <span>Răspuns în 24h</span>
                        </div>
                        <div class="trust-indicator">
                            <i class="fas fa-star"></i>
                            <span>Recenzii reale</span>
                        </div>
                    </div>
                </div>
                
                <!-- Search Form -->
                <div class="card shadow-xl border-0">
                    <div class="card-body p-4">
                        <h5 class="card-title text-dark mb-3 fw-bold" style="color: #6d28d9 !important;">Caută servicii în zona ta</h5>
                        <form method="GET" action="{% url 'core:search' %}">
                            <div class="row g-3 align-items-end">
                                <div class="col-md-5">
                                    <label class="form-label text-dark">Ce serviciu cauți?</label>
                                    <input type="text" name="q" class="form-control form-control-lg"
                                           placeholder="ex. renovare casă" value="{{ request.GET.q }}"
                                           list="popular-services" style="border-color: #6d28d9; color: #6d28d9;">
                                    <datalist id="popular-services">
                                        <option value="Renovare baie">
                                        <option value="Instalare aer condiționat">
                                        <option value="Vopsit apartament">
                                        <option value="Montaj parchet">
                                        <option value="Reparații instalații sanitare">
                                        <option value="Amenajare grădină">
                                        <option value="Montaj gresie și faianță">
                                        <option value="Instalații electrice">
                                        <option value="Reparații acoperiș">
                                        <option value="Curățenie după renovare">
                                        <option value="Montaj mobilier">
                                        <option value="Transport și mutare">
                                    </datalist>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label text-dark">Județul</label>
                                    <select name="county" class="form-select form-select-lg" style="border-color: #6d28d9; color: #6d28d9;">
                                        <option value="">Alege județul</option>
                                        {% for county in counties %}
                                            <option value="{{ county.id }}">{{ county.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <button type="submit" class="btn btn-success btn-lg w-100 shadow-sm d-flex align-items-center justify-content-center">
                                        <i class="fas fa-search me-2"></i>Caută
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- Popular Services -->
                        <div class="mt-4">
                            <small class="text-muted fw-semibold">Servicii populare:</small>
                            <div class="mt-2">
                                <a href="{% url 'core:search' %}?q=renovare+baie" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Renovare baie</a>
                                <a href="{% url 'core:search' %}?q=vopsit+apartament" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Vopsit apartament</a>
                                <a href="{% url 'core:search' %}?q=montaj+parchet" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Montaj parchet</a>
                                <a href="{% url 'core:search' %}?q=instalatii+sanitare" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Instalații sanitare</a>
                                <a href="{% url 'core:search' %}?q=amenajare+gradina" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Amenajare grădină</a>
                                <a href="{% url 'core:search' %}?q=transport+mutare" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none me-2 mb-2 px-3 py-2">Transport și mutare</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    {% if user.is_authenticated %}
                        {% if user.user_type == 'client' %}
                            <a href="{% url 'services:create_order' %}" class="btn btn-light btn-lg me-3">
                                <i class="fas fa-plus me-2"></i>Postează o comandă
                            </a>
                            <a href="{% url 'services:my_orders' %}" class="btn btn-outline-light btn-lg">
                                <i class="fas fa-list me-2"></i>Comenzile mele
                            </a>
                        {% elif user.user_type == 'craftsman' %}
                            <a href="{% url 'services:available_orders' %}" class="btn btn-light btn-lg me-3">
                                <i class="fas fa-search me-2"></i>Caută comenzi noi
                            </a>
                            <a href="{% url 'services:my_quotes' %}" class="btn btn-outline-light btn-lg">
                                <i class="fas fa-handshake me-2"></i>Ofertele mele
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'services:create_order' %}" class="btn btn-light btn-lg me-3">
                            <i class="fas fa-plus me-2"></i>Postează o comandă
                        </a>
                        <a href="{% url 'auth:craftsman_register' %}" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-user-plus me-2"></i>Devino meșter
                        </a>
                    {% endif %}
                </div>
            </div>
            
            <div class="col-lg-6 hero-image-container d-none d-lg-block">
                <div class="hero-image-wrapper">
                    <img src="{% static 'images/worker.webp' %}"
                         alt="Meșteri profesioniști la lucru - Bricli conectează clienții cu specialiști verificați"
                         class="hero-image"
                         loading="eager"
                         decoding="async"
                         onload="this.classList.add('loaded')"
                         onerror="this.style.display='none'">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Platform Statistics -->
<section class="stats-banner bg-light py-5">
    <div class="container">
        <div class="row text-center g-3 justify-content-center">
            <div class="col-12 col-lg-5">
                <div class="stat-card">
                    <div class="d-flex align-items-center justify-content-center gap-3">
                        <i class="fas fa-users text-primary"></i>
                        <div>
                            <h3 class="fw-bold mb-0">{{ stats.active_craftsmen }}</h3>
                            <p class="mb-0">Meșteri activi verificați</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-5">
                <div class="stat-card">
                    <div class="d-flex align-items-center justify-content-center gap-3">
                        <i class="fas fa-check-circle text-success"></i>
                        <div>
                            <h3 class="fw-bold mb-0">{{ stats.completed_projects }}</h3>
                            <p class="mb-0">Proiecte finalizate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- BETA Launch Section -->
{% if not SUBSCRIPTIONS_ENABLED %}
<section class="py-5 bg-white">
    <div class="container">
        <div class="row align-items-center">
            <!-- BETA Info & Counter -->
            <div class="col-lg-6 mb-4 mb-lg-0">
                <div class="text-center text-lg-start">
                    <span class="badge bg-success px-4 py-2 fs-5 mb-3">
                        <i class="fas fa-rocket me-2"></i>BETA 2025
                    </span>
                    <h2 class="fw-bold mb-3">Alătură-te Primilor 100 Meseriași din România!</h2>
                    <p class="lead text-muted mb-4">
                        Bricli lansează oficial în România. Primii 100 meseriași beneficiază de <strong>acces gratuit nelimitat</strong> - fără taxe, fără restricții.
                    </p>

                    <!-- BETA Counter -->
                    <div class="beta-counter-card shadow-sm p-4 mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-6 text-center mb-3 mb-md-0">
                                <div class="beta-progress-ring">
                                    <span class="beta-count-number">{{ beta_count }}</span>
                                    <span class="beta-count-total">/100</span>
                                </div>
                            </div>
                            <div class="col-md-6 text-center text-md-start">
                                <h5 class="fw-bold text-success mb-2">
                                    {% if beta_count < 100 %}
                                        {{ 100|add:"-"|add:beta_count }} locuri disponibile
                                    {% else %}
                                        Complet!
                                    {% endif %}
                                </h5>
                                <p class="text-muted mb-0 small">
                                    Lead-uri nelimitate • Mesaje gratuite • Toate funcțiile premium
                                </p>
                            </div>
                        </div>
                    </div>

                    <a href="{% url 'auth:craftsman_register' %}" class="btn btn-success btn-lg shadow-sm">
                        <i class="fas fa-rocket me-2"></i>Înregistrează-te GRATUIT
                    </a>
                </div>
            </div>

            <!-- Mini FAQ -->
            <div class="col-lg-6">
                <div class="beta-faq">
                    <h4 class="fw-bold mb-4 text-center text-lg-start">Întrebări Frecvente BETA</h4>

                    <div class="accordion accordion-flush" id="betaFAQ">
                        <!-- FAQ 1 -->
                        <div class="accordion-item border-0 mb-2">
                            <h2 class="accordion-header" id="faq1">
                                <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1">
                                    <i class="fas fa-question-circle text-success me-2"></i>
                                    Ce înseamnă BETA?
                                </button>
                            </h2>
                            <div id="collapse1" class="accordion-collapse collapse" data-bs-parent="#betaFAQ">
                                <div class="accordion-body">
                                    Testăm platforma cu primii 100 meseriași din România. Toate funcțiile sunt 100% gratuite - lead-uri, mesaje, oferte nelimitate.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 2 -->
                        <div class="accordion-item border-0 mb-2">
                            <h2 class="accordion-header" id="faq2">
                                <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2">
                                    <i class="fas fa-question-circle text-success me-2"></i>
                                    Cât durează perioada BETA?
                                </button>
                            </h2>
                            <div id="collapse2" class="accordion-collapse collapse" data-bs-parent="#betaFAQ">
                                <div class="accordion-body">
                                    Perioada BETA durează până la lansarea oficială. Primii 100 membri păstrează accesul gratuit pe toată perioada.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 3 -->
                        <div class="accordion-item border-0 mb-2">
                            <h2 class="accordion-header" id="faq3">
                                <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse3">
                                    <i class="fas fa-question-circle text-success me-2"></i>
                                    Ce se întâmplă după lansare?
                                </button>
                            </h2>
                            <div id="collapse3" class="accordion-collapse collapse" data-bs-parent="#betaFAQ">
                                <div class="accordion-body">
                                    După lansare vom introduce planuri plătite. Primii 100 membri BETA vor primi condiții speciale ca mulțumire pentru sprijin.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 4 -->
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header" id="faq4">
                                <button class="accordion-button collapsed bg-light rounded" type="button" data-bs-toggle="collapse" data-bs-target="#collapse4">
                                    <i class="fas fa-question-circle text-success me-2"></i>
                                    De ce doar 100 meseriași?
                                </button>
                            </h2>
                            <div id="collapse4" class="accordion-collapse collapse" data-bs-parent="#betaFAQ">
                                <div class="accordion-body">
                                    Vrem să oferim o experiență de calitate și suport personalizat. Limita de 100 ne permite să colectăm feedback și să îmbunătățim platforma împreună cu comunitatea.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Service Categories -->
<section class="py-5 grid-2-mobile">
    <div class="container">
        <div class="text-center mb-5 fade-in">
            <h2 class="fw-bold text-gradient home-section-title">Servicii populare</h2>
            <p class="text-muted clamp-1">Găsește specialiști pentru toate nevoile tale</p>
        </div>

        <div class="row g-4" id="catGrid">
            {% for category in service_categories %}
            <div class="col-lg-3 col-md-6 slide-up cat-card">
                <a href="{% url 'services:category_detail' category.slug %}" class="text-decoration-none">
                    <div class="service-category-card category-card h-100">
                        <div class="card-body text-center p-4">
                            {% category_icon_lg category %}
                            <h5 class="card-title fw-bold mt-3 clamp-1">{{ category.name }}</h5>
                            <p class="card-text text-muted clamp-2">{{ category.description|truncatewords:10 }}</p>
                            <div class="mb-2">
                                <span class="badge text-white" style="background-color: #8B5CF6;">
                                    {{ category.orders_count|default:0 }} comenzi active
                                </span>
                            </div>
                            <small class="fw-medium" style="color: #8B5CF6;">
                                <i class="fas fa-arrow-right me-1"></i>Vezi specialiști
                            </small>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-4 d-lg-none">
            <button id="showAllCats" class="btn btn-outline-secondary btn-sm">Vezi toate serviciile</button>
        </div>

        <div class="text-center mt-4 d-none d-lg-block">
            <a href="{% url 'services:categories' %}" class="btn btn-outline-primary">
                Vezi toate serviciile <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</section>

<!-- How it Works -->
<section class="howitworks-banner bg-light py-5">
    <div class="container">
        <div class="row text-center g-3">
            <div class="col-12 col-lg-4">
                <div class="step">
                    <div class="icon mx-auto mb-2">
                        <span class="fw-bold">1</span>
                    </div>
                    <h3>Postează cererea</h3>
                    <p>Descrii lucrarea o singură dată. Este gratuit.</p>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <div class="step">
                    <div class="icon mx-auto mb-2">
                        <span class="fw-bold">2</span>
                    </div>
                    <h3>Primești oferte</h3>
                    <p>Compari prețuri, recenzii și portofolii.</p>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <div class="step">
                    <div class="icon mx-auto mb-2">
                        <span class="fw-bold">3</span>
                    </div>
                    <h3>Angajezi în siguranță</h3>
                    <p>Plătești doar când ești mulțumit de rezultat.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Craftsmen -->
{% if top_craftsmen %}
<section class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Meșteri de top</h2>
            <p class="text-muted">Specialiști cu cele mai bune recenzii</p>
        </div>
        
        <div class="row g-4">
            {% for craftsman in top_craftsmen %}
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 shadow-sm">
                    <div class="card-body text-center">
                        {% if craftsman.profile_photo %}
                            <img src="{{ craftsman.profile_photo.url }}?v={% image_version craftsman.profile_photo fallback_dt=craftsman.updated_at %}" alt="{{ craftsman.user.get_full_name|default:craftsman.user.username }}" class="rounded-circle mb-3" width="80" height="80" style="object-fit: cover;" loading="lazy">
                        {% elif craftsman.user.profile_picture %}
                            <img src="{{ craftsman.user.profile_picture.url }}?v={% profile_img_version craftsman.user %}" alt="{{ craftsman.user.get_full_name|default:craftsman.user.username }}" class="rounded-circle mb-3" width="80" height="80" style="object-fit: cover;" loading="lazy">
                        {% else %}
                            <img src="{% static 'images/avatar.svg' %}" alt="{{ craftsman.user.get_full_name|default:craftsman.user.username }}" class="rounded-circle mb-3" width="80" height="80" style="object-fit: cover;" loading="lazy">
                        {% endif %}
                        
                        <h5 class="card-title">
                            {{ craftsman.user.get_full_name|default:craftsman.user.username }}
                            {# Phase 9: Tier Badge #}
                            {% if craftsman.subscription %}
                                {% if craftsman.subscription.tier.name == 'pro' %}
                                <span class="tier-badge tier-pro ms-2">
                                    <i class="fas fa-crown"></i>Pro
                                </span>
                                {% elif craftsman.subscription.tier.name == 'plus' %}
                                <span class="tier-badge tier-plus ms-2">
                                    <i class="fas fa-star"></i>Plus
                                </span>
                                {% endif %}
                            {% endif %}
                        </h5>
                        <p class="text-muted">{{ craftsman.company_name|default:"Meșter independent" }}</p>
                        
                        <div class="mb-2">
                            {% for i in "12345" %}
                                {% if forloop.counter <= craftsman.average_rating %}
                                    <i class="fas fa-star" style="color: #8B5CF6;"></i>
                                {% else %}
                                    <i class="far fa-star" style="color: #8B5CF6;"></i>
                                {% endif %}
                            {% endfor %}
                            <span class="text-muted ms-2">
                                <a href="{% url 'accounts:craftsman_detail' craftsman.pk %}#reviews"
                                   style="color: #6c757d; text-decoration: none; transition: color 0.2s ease;"
                                   onmouseover="this.style.color='#8B5CF6'; this.style.textDecoration='underline';"
                                   onmouseout="this.style.color='#6c757d'; this.style.textDecoration='none';">
                                    ({{ craftsman.total_reviews }} recenzii)
                                </a>
                            </span>
                        </div>
                        
                        <p class="text-muted small">{{ craftsman.city }}, {{ craftsman.county }}</p>
                        
                        <a href="{% url 'accounts:craftsman_detail' craftsman.pk %}" class="btn btn-outline-primary">
                            Vezi profilul
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{% url 'accounts:craftsmen_list' %}" class="btn btn-outline-primary">
                Vezi toți meșterii <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Testimonials -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Ce spun clienții noștri</h2>
            <p class="text-muted">Experiențe reale de la utilizatorii Bricli</p>
        </div>

        {% render_testimonials 6 %}
    </div>
</section>

<!-- CTA Section -->
<section class="py-5 bg-primary text-white">
    <div class="container text-center">
        <h2 class="fw-bold mb-4 text-white">Gata să începi?</h2>
        <p class="lead mb-4 text-white">Alătură-te miilor de români care și-au găsit meșterul perfect pe Bricli</p>

        <div class="row justify-content-center cta-responsive">
            <div class="col-md-8">
                <a href="{% url 'services:create_order' %}" class="btn btn-light btn-lg me-3 mb-3">
                    <i class="fas fa-plus me-2"></i>Postează o comandă gratuită
                </a>
                <a href="{% url 'auth:craftsman_register' %}" class="btn btn-outline-light btn-lg mb-3">
                    <i class="fas fa-user-plus me-2"></i>Înregistrează-te ca meșter
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
.hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.min-vh-75 {
    min-height: 75vh;
}

.hover-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}

.step-icon {
    font-size: 2rem;
}

/* Phase 9: Tier Badges */
.tier-badge {
    padding: 0.25rem 0.6rem;
    border-radius: 16px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    white-space: nowrap;
    vertical-align: middle;
}

.tier-plus {
    background: linear-gradient(135deg, #8B5CF6, #7C3AED);
    color: white;
    box-shadow: 0 2px 6px rgba(139, 92, 246, 0.3);
}

.tier-pro {
    background: linear-gradient(135deg, #F59E0B, #D97706);
    color: white;
    box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
}

.tier-badge i {
    font-size: 0.7rem;
}

/* BETA Section Styles */
.beta-counter-card {
    background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%);
    border-radius: 16px;
    border: 2px solid #10b981;
}

.beta-progress-ring {
    position: relative;
    display: inline-block;
}

.beta-count-number {
    font-size: 3.5rem;
    font-weight: 800;
    color: #10b981;
    line-height: 1;
}

.beta-count-total {
    font-size: 2rem;
    font-weight: 600;
    color: #6b7280;
    line-height: 1;
}

.beta-faq .accordion-button {
    font-weight: 600;
    color: #1f2937;
    padding: 1rem 1.25rem;
}

.beta-faq .accordion-button:not(.collapsed) {
    background-color: #10b981;
    color: white;
}

.beta-faq .accordion-button:not(.collapsed) .fas {
    color: white !important;
}

.beta-faq .accordion-body {
    padding: 1rem 1.25rem;
    color: #4b5563;
    line-height: 1.6;
}
</style>

{% lazy_loading_scripts %}
{% endblock %}
