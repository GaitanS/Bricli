{% load pagination_optimized %}

<nav aria-label="Pagination" class="d-flex justify-content-between align-items-center mt-4">
    <!-- Page size selector -->
    <div class="d-flex align-items-center">
        <label for="page-size" class="form-label me-2 mb-0 text-muted small">Afișează:</label>
        <select id="page-size" class="form-select form-select-sm" style="width: auto;" onchange="changePageSize(this.value)">
            {% for size in page_obj.paginator.per_page|get_page_size_options %}
                <option value="{{ size }}" {% if size == page_obj.paginator.per_page %}selected{% endif %}>
                    {{ size }} rezultate
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Pagination controls -->
    <div class="d-flex align-items-center">
        <!-- Results info -->
        <span class="text-muted small me-3">
            {{ page_obj.start_index }}-{{ page_obj.end_index }} din {{ page_obj.paginator.count }} rezultate
        </span>

        <!-- Pagination links -->
        <ul class="pagination pagination-sm mb-0">
            <!-- Previous page -->
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="{% page_url query_string page_obj.previous_page_number %}" aria-label="Pagina anterioară">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link"><i class="fas fa-chevron-left"></i></span>
                </li>
            {% endif %}

            <!-- First page -->
            {% if show_first %}
                <li class="page-item">
                    <a class="page-link" href="{% page_url query_string 1 %}">1</a>
                </li>
            {% endif %}

            <!-- Previous ellipsis -->
            {% if show_prev_ellipsis %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            <!-- Page range -->
            {% for page_num in page_range %}
                {% if page_num == page_obj.number %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link" href="{% page_url query_string page_num %}">{{ page_num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            <!-- Next ellipsis -->
            {% if show_next_ellipsis %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            <!-- Last page -->
            {% if show_last %}
                <li class="page-item">
                    <a class="page-link" href="{% page_url query_string page_obj.paginator.num_pages %}">{{ page_obj.paginator.num_pages }}</a>
                </li>
            {% endif %}

            <!-- Next page -->
            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="{% page_url query_string page_obj.next_page_number %}" aria-label="Pagina următoare">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link"><i class="fas fa-chevron-right"></i></span>
                </li>
            {% endif %}
        </ul>
    </div>
</nav>

<script>
function changePageSize(size) {
    const url = new URL(window.location);
    url.searchParams.set('page_size', size);
    url.searchParams.delete('page'); // Reset to first page
    window.location.href = url.toString();
}
</script>